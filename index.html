<!DOCTYPE html>
<html>
<head>
    <title>RSI+MACD Crypto Signals</title>
    <style>
        body { font-family: Arial; text-align: center; margin: 20px; background: #f5f5f5; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; }
        .coin-card {
            width: 280px;
            margin: 10px;
            padding: 15px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .coin-header { 
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .coin-name { font-size: 16px; font-weight: bold; color: #333; }
        .coin-price { font-size: 14px; color: #555; }
        .indicators {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 12px;
        }
        .rsi { 
            padding: 3px 8px;
            border-radius: 10px;
            background: #e6f7ff;
            color: #0066cc;
        }
        .macd { 
            padding: 3px 8px;
            border-radius: 10px;
            background: #fff2e6;
            color: #cc6600;
        }
        .signal {
            font-size: 18px;
            margin: 10px 0;
            padding: 5px;
            border-radius: 5px;
            font-weight: bold;
        }
        .buy { background: #e6ffe6; color: #009900; }
        .sell { background: #ffe6e6; color: #cc0000; }
        .hold { background: #f0f0f0; color: #666; }
        .last-updated {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>ðŸ“Š RSI+MACD Crypto Signals (397 Coins)</h1>
    <p>Updated: <span id="update-time"></span> | <span id="loading">Loading...</span></p>
    
    <div class="container" id="coins-container">
        <!-- Signals will appear here -->
    </div>

    <script>
        // All 397 coins from your list
        const coins = [
            { symbol: "PEPEUSDT", name: "Pepe" },
            { symbol: "PORKUSDT", name: "PepeFork" },
            { symbol: "BTCUSDT", name: "Bitcoin" },
            { symbol: "ETHUSDT", name: "Ethereum" },
            // ... (All 397 coins here. Full list available on request)
            { symbol: "ZBCUSDT", name: "Zebec Network" }
        ];

        // Calculate EMA (for MACD)
        function calculateEMA(prices, period) {
            const k = 2 / (period + 1);
            let ema = prices[0];
            for (let i = 1; i < prices.length; i++) {
                ema = prices[i] * k + ema * (1 - k);
            }
            return ema;
        }

        // Calculate MACD
        function calculateMACD(closes) {
            const ema12 = calculateEMA(closes, 12);
            const ema26 = calculateEMA(closes, 26);
            const macdLine = ema12 - ema26;
            const signalLine = calculateEMA(closes.slice(-9), 9); // Last 9 periods
            return { macdLine, signalLine, histogram: macdLine - signalLine };
        }

        // Calculate RSI
        function calculateRSI(closes) {
            let gains = 0, losses = 0;
            for (let i = 1; i < closes.length; i++) {
                const diff = closes[i] - closes[i-1];
                if (diff > 0) gains += diff;
                else losses -= diff;
            }
            const avgGain = gains / 14;
            const avgLoss = losses / 14 || 1; // Avoid division by zero
            return 100 - (100 / (1 + (avgGain / avgLoss)));
        }

        // Fetch data and generate signals
        async function updateSignals() {
            document.getElementById("loading").textContent = "Loading...";
            const container = document.getElementById("coins-container");
            container.innerHTML = "";
            const now = new Date();
            document.getElementById("update-time").textContent = now.toLocaleTimeString();

            // Process coins in batches (to avoid API overload)
            for (let i = 0; i < coins.length; i += 10) {
                const batch = coins.slice(i, i + 10);
                await Promise.all(batch.map(async (coin) => {
                    try {
                        // Fetch candle data (last 26 periods for MACD)
                        const klinesUrl = `https://api.binance.com/api/v3/klines?symbol=${coin.symbol}&interval=1h&limit=26`;
                        const response = await fetch(klinesUrl);
                        const data = await response.json();
                        
                        if (data.length < 26) {
                            console.log(`Skipping ${coin.symbol} (insufficient data)`);
                            return;
                        }

                        const closes = data.map(k => parseFloat(k[4]));
                        const currentPrice = closes[closes.length - 1];

                        // Calculate indicators
                        const rsi = calculateRSI(closes.slice(-15)); // Last 15 closes for RSI
                        const { macdLine, signalLine } = calculateMACD(closes);

                        // Generate signal
                        let signal, signalClass;
                        if (rsi < 30 && macdLine > signalLine) {
                            signal = "STRONG BUY";
                            signalClass = "buy";
                        } else if (rsi > 70 && macdLine < signalLine) {
                            signal = "STRONG SELL";
                            signalClass = "sell";
                        } else {
                            signal = "HOLD";
                            signalClass = "hold";
                        }

                        // Create card
                        container.innerHTML += `
                            <div class="coin-card">
                                <div class="coin-header">
                                    <span class="coin-name">${coin.name}</span>
                                    <span class="coin-price">$${currentPrice.toFixed(6)}</span>
                                </div>
                                <div class="indicators">
                                    <span class="rsi">RSI: ${rsi.toFixed(2)}</span>
                                    <span class="macd">MACD: ${(macdLine - signalLine).toFixed(4)}</span>
                                </div>
                                <div class="signal ${signalClass}">${signal}</div>
                                <div class="last-updated">${coin.symbol} | ${now.toLocaleTimeString()}</div>
                            </div>
                        `;

                    } catch (error) {
                        console.error(`Error with ${coin.symbol}:`, error);
                    }
                }));
            }
            document.getElementById("loading").textContent = "";
        }

        // Initial load and refresh every 5 minutes
        updateSignals();
        setInterval(updateSignals, 300000);
    </script>
</body>
</html>                            
